{
  "windows_rules": [
    {
      "id": "public_tcp_listeners",
      "severity": 2,
      "tags": [
        "network",
        "posture"
      ],
      "cmd": "powershell Get-NetTCPConnection | Where-Object { $_.State -eq 'Listen' -and $_.LocalAddress -eq '0.0.0.0' } | Select-Object -Property LocalAddress, LocalPort, OwningProcess | Format-Table -AutoSize",
      "sample_limit": 8,
      "description": "Detects TCP services listening on all interfaces (0.0.0.0). This exposes services to the network unnecessarily."
    },
    {
      "id": "public_udp_listeners",
      "severity": 2,
      "tags": [
        "network",
        "posture"
      ],
      "cmd": "powershell Get-NetUDPEndpoint | Where-Object { $_.LocalAddress -eq '0.0.0.0' } | Select-Object -Property LocalAddress, LocalPort, OwningProcess | Format-Table -AutoSize",
      "sample_limit": 8,
      "description": "Identifies UDP services listening on all interfaces. Public UDP listeners can be exploited for amplification attacks."
    },
    {
      "id": "firewall_disabled",
      "severity": 3,
      "tags": [
        "firewall",
        "posture"
      ],
      "cmd": "powershell Get-NetFirewallProfile | Where-Object { $_.Enabled -eq $false } | Select-Object -Property Name, Enabled | Format-Table -AutoSize",
      "sample_limit": 8,
      "description": "Checks if Windows Firewall is disabled. Firewalls are essential for network security."
    },
    {
      "id": "defender_disabled",
      "severity": 3,
      "tags": [
        "antivirus",
        "defender"
      ],
      "cmd": "powershell Get-MpComputerStatus | Where-Object { $_.AntivirusEnabled -eq $false -or $_.RealTimeProtectionEnabled -eq $false } | Select-Object -Property AntivirusEnabled, RealTimeProtectionEnabled | Format-Table -AutoSize",
      "sample_limit": 8,
      "description": "Detects if Windows Defender is disabled. Antivirus protection is critical for security."
    },
    {
      "id": "suspicious_startup_programs",
      "severity": 2,
      "tags": [
        "persistence",
        "startup"
      ],
      "cmd": "powershell Get-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -ErrorAction SilentlyContinue | Get-Member -MemberType NoteProperty | Where-Object { $_.Name -notlike 'PS*' } | Select-Object -Property Name",
      "sample_limit": 10,
      "description": "Lists programs configured to run at startup. Suspicious entries may indicate malware persistence."
    },
    {
      "id": "scheduled_tasks_system",
      "severity": 3,
      "tags": [
        "scheduled_tasks",
        "persistence"
      ],
      "cmd": "powershell Get-ScheduledTask | Where-Object { $_.State -eq 'Running' -and $_.Principal.UserId -like '*SYSTEM*' } | Select-Object -Property TaskName, State, Principal | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies scheduled tasks running as SYSTEM. These tasks have high privileges and should be reviewed."
    },
    {
      "id": "admin_users",
      "severity": 4,
      "tags": [
        "users",
        "privileges"
      ],
      "cmd": "powershell Get-LocalGroupMember -Group 'Administrators' | Select-Object -Property Name, PrincipalSource | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Lists all users in the Administrators group. Excessive admin users increase attack surface."
    },
    {
      "id": "guest_account_enabled",
      "severity": 3,
      "tags": [
        "users",
        "posture"
      ],
      "cmd": "powershell Get-LocalUser | Where-Object { $_.Name -eq 'Guest' -and $_.Enabled -eq $true } | Select-Object -Property Name, Enabled | Format-Table -AutoSize",
      "sample_limit": 1,
      "description": "Detects if the Guest account is enabled. Guest accounts should be disabled for security."
    },
    {
      "id": "password_policy_weak",
      "severity": 3,
      "tags": [
        "password",
        "policy"
      ],
      "cmd": "powershell Get-LocalUser | Where-Object { $_.PasswordExpires -eq $false -or $_.PasswordRequired -eq $false } | Select-Object -Property Name, PasswordExpires, PasswordRequired | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies users with weak password policies (non-expiring or no password required)."
    },
    {
      "id": "world_writable_files_system32",
      "severity": 2,
      "tags": [
        "file",
        "permissions"
      ],
      "cmd": "powershell Get-ChildItem -Path 'C:\\Windows\\System32' -Recurse -File -ErrorAction SilentlyContinue | Get-Acl | Where-Object { ($_.Access | Where-Object { $_.IdentityReference -eq 'Everyone' -and $_.FileSystemRights -match 'Write' }) } | Select-Object -Property Path | Format-Table -AutoSize",
      "sample_limit": 8,
      "description": "Detects world-writable files in System32 directory. World-writable system files are security risks."
    },
    {
      "id": "world_writable_files_programfiles",
      "severity": 2,
      "tags": [
        "file",
        "permissions"
      ],
      "cmd": "powershell Get-ChildItem -Path 'C:\\Program Files' -Recurse -File -ErrorAction SilentlyContinue | Get-Acl | Where-Object { ($_.Access | Where-Object { $_.IdentityReference -eq 'Everyone' -and $_.FileSystemRights -match 'Write' }) } | Select-Object -Property Path | Format-Table -AutoSize",
      "sample_limit": 8,
      "description": "Identifies world-writable files in Program Files directory."
    },
    {
      "id": "suspicious_services",
      "severity": 2,
      "tags": [
        "services",
        "posture"
      ],
      "cmd": "powershell Get-Service | Where-Object { $_.Status -eq 'Running' -and ($_.DisplayName -like '*temp*' -or $_.Name -like '*temp*' -or $_.Path -like '*temp*') } | Select-Object -Property Name, DisplayName, Status | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Detects services with suspicious names or paths (containing 'temp')."
    },
    {
      "id": "services_no_description",
      "severity": 4,
      "tags": [
        "services",
        "posture"
      ],
      "cmd": "powershell Get-WmiObject Win32_Service | Where-Object { $_.Description -eq '' -or $_.Description -eq $null } | Select-Object -Property Name, DisplayName, Description | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies services without descriptions. Services without descriptions may be suspicious."
    },
    {
      "id": "registry_autorun_user",
      "severity": 3,
      "tags": [
        "registry",
        "persistence"
      ],
      "cmd": "powershell Get-ItemProperty -Path 'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -ErrorAction SilentlyContinue | Get-Member -MemberType NoteProperty | Where-Object { $_.Name -notlike 'PS*' } | Select-Object -Property Name",
      "sample_limit": 10,
      "description": "Lists user-level autorun registry entries. These can be used for persistence."
    },
    {
      "id": "registry_autorun_system",
      "severity": 3,
      "tags": [
        "registry",
        "persistence"
      ],
      "cmd": "powershell Get-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -ErrorAction SilentlyContinue | Get-Member -MemberType NoteProperty | Where-Object { $_.Name -notlike 'PS*' } | Select-Object -Property Name",
      "sample_limit": 10,
      "description": "Lists system-level autorun registry entries."
    },
    {
      "id": "processes_temp_location",
      "severity": 2,
      "tags": [
        "processes",
        "edr"
      ],
      "cmd": "powershell Get-Process | Where-Object { $_.Path -like '*temp*' -or $_.Path -like '*appdata*local*temp*' } | Select-Object -Property ProcessName, Id, Path | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Detects processes running from temporary directories. This is often a sign of malware."
    },
    {
      "id": "processes_suspicious_names",
      "severity": 2,
      "tags": [
        "processes",
        "edr"
      ],
      "cmd": "powershell Get-Process | Where-Object { $_.ProcessName -like '*svchost*' -or $_.ProcessName -like '*dllhost*' -or $_.ProcessName -like '*rundll32*' } | Where-Object { $_.Path -notlike '*Windows\\System32*' -and $_.Path -notlike '*Windows\\SysWOW64*' } | Select-Object -Property ProcessName, Id, Path | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies processes with system-like names running from non-system locations."
    },
    {
      "id": "network_connections_suspicious",
      "severity": 2,
      "tags": [
        "network",
        "edr"
      ],
      "cmd": "powershell Get-NetTCPConnection | Where-Object { $_.State -eq 'Established' -and $_.RemoteAddress -notlike '192.168.*' -and $_.RemoteAddress -notlike '10.*' -and $_.RemoteAddress -notlike '172.16.*' -and $_.RemoteAddress -ne '127.0.0.1' } | Select-Object -Property LocalAddress, LocalPort, RemoteAddress, RemotePort, OwningProcess | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Detects network connections to external (non-private) IP addresses."
    },
    {
      "id": "shares_public",
      "severity": 3,
      "tags": [
        "shares",
        "posture"
      ],
      "cmd": "powershell Get-SmbShare | Where-Object { $_.Description -like '*public*' -or $_.Name -like '*public*' } | Select-Object -Property Name, Description, Path | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies public SMB shares. Public shares can expose sensitive data."
    },
    {
      "id": "shares_everyone_access",
      "severity": 3,
      "tags": [
        "shares",
        "posture"
      ],
      "cmd": "powershell Get-SmbShare | ForEach-Object { Get-SmbShareAccess -Name $_.Name | Where-Object { $_.AccountName -eq 'Everyone' } } | Select-Object -Property Name, AccountName, AccessRight | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Detects SMB shares with Everyone access. This allows unauthorized access."
    },
    {
      "id": "bitlocker_disabled",
      "severity": 3,
      "tags": [
        "encryption",
        "bitlocker"
      ],
      "cmd": "powershell Get-BitLockerVolume | Where-Object { $_.VolumeStatus -ne 'FullyEncrypted' } | Select-Object -Property MountPoint, VolumeStatus, EncryptionPercentage | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Checks if BitLocker encryption is disabled or incomplete on volumes."
    },
    {
      "id": "remote_desktop_enabled",
      "severity": 2,
      "tags": [
        "remote_access",
        "rdp"
      ],
      "cmd": "powershell (Get-ItemProperty -Path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server' -Name 'fDenyTSConnections').fDenyTSConnections",
      "sample_limit": 1,
      "description": "Detects if Remote Desktop is enabled. RDP should be disabled if not needed."
    },
    {
      "id": "uac_disabled",
      "severity": 3,
      "tags": [
        "uac",
        "posture"
      ],
      "cmd": "powershell (Get-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System' -Name 'EnableLUA').EnableLUA",
      "sample_limit": 1,
      "description": "Checks if User Account Control (UAC) is disabled. UAC should be enabled for security."
    },
    {
      "id": "audit_policy_weak",
      "severity": 3,
      "tags": [
        "audit",
        "logging"
      ],
      "cmd": "powershell auditpol /get /category:* | Select-String -Pattern 'No Auditing'",
      "sample_limit": 10,
      "description": "Identifies audit policies set to 'No Auditing'. Proper auditing is essential for security."
    },
    {
      "id": "event_log_cleared",
      "severity": 2,
      "tags": [
        "logging",
        "forensics"
      ],
      "cmd": "powershell Get-WinEvent -LogName Security -MaxEvents 1 | Where-Object { $_.Id -eq 1102 } | Select-Object -Property TimeCreated, Id, Message | Format-Table -AutoSize",
      "sample_limit": 5,
      "description": "Detects if security event log has been cleared. This may indicate an attempt to hide activity."
    },
    {
      "id": "scheduled_tasks_hidden",
      "severity": 2,
      "tags": [
        "scheduled_tasks",
        "persistence"
      ],
      "cmd": "powershell Get-ScheduledTask | Where-Object { $_.Settings.Hidden -eq $true } | Select-Object -Property TaskName, State, Settings | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies hidden scheduled tasks. Hidden tasks may be used for persistence."
    },
    {
      "id": "wmi_persistence",
      "severity": 2,
      "tags": [
        "wmi",
        "persistence"
      ],
      "cmd": "powershell Get-WmiObject -Namespace root\\subscription -Class __EventFilter | Select-Object -Property Name, Query | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Detects WMI event filters that could be used for persistence."
    },
    {
      "id": "powershell_execution_policy_bypass",
      "severity": 2,
      "tags": [
        "powershell",
        "execution"
      ],
      "cmd": "powershell Get-ExecutionPolicy -List | Where-Object { $_.ExecutionPolicy -eq 'Bypass' -or $_.ExecutionPolicy -eq 'Unrestricted' } | Select-Object -Property Scope, ExecutionPolicy | Format-Table -AutoSize",
      "sample_limit": 5,
      "description": "Identifies PowerShell execution policies set to Bypass or Unrestricted. This reduces security."
    },
    {
      "id": "dns_servers_suspicious",
      "severity": 2,
      "tags": [
        "network",
        "dns"
      ],
      "cmd": "powershell Get-DnsClientServerAddress | Where-Object { $_.ServerAddresses -notlike '*8.8.8.8*' -and $_.ServerAddresses -notlike '*1.1.1.1*' } | Select-Object -Property InterfaceAlias, ServerAddresses | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Detects non-standard DNS servers. Suspicious DNS servers may be used for DNS hijacking."
    },
    {
      "id": "proxy_settings",
      "severity": 3,
      "tags": [
        "network",
        "proxy"
      ],
      "cmd": "powershell Get-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings' | Select-Object -Property ProxyEnable, ProxyServer | Format-Table -AutoSize",
      "sample_limit": 5,
      "description": "Lists proxy settings. Suspicious proxy configurations may indicate network interception."
    },
    {
      "id": "windows_updates_disabled",
      "severity": 3,
      "tags": [
        "updates",
        "patch"
      ],
      "cmd": "powershell (Get-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'NoAutoUpdate' -ErrorAction SilentlyContinue).NoAutoUpdate",
      "sample_limit": 1,
      "description": "Checks if Windows automatic updates are disabled. Regular updates are critical for security."
    },
    {
      "id": "smb_v1_enabled",
      "severity": 2,
      "tags": [
        "smb",
        "protocol"
      ],
      "cmd": "powershell Get-WindowsOptionalFeature -Online -FeatureName 'SMB1Protocol' | Where-Object { $_.State -eq 'Enabled' } | Select-Object -Property FeatureName, State | Format-Table -AutoSize",
      "sample_limit": 1,
      "description": "Detects if SMBv1 is enabled. SMBv1 is deprecated and vulnerable. Should be disabled."
    },
    {
      "id": "tls_weak_ciphers",
      "severity": 2,
      "tags": [
        "tls",
        "encryption"
      ],
      "cmd": "powershell Get-TlsCipherSuite | Where-Object { $_.Name -like '*RC4*' -or $_.Name -like '*DES*' -or $_.Name -like '*MD5*' } | Select-Object -Property Name, CipherSuite | Format-Table -AutoSize",
      "sample_limit": 10,
      "description": "Identifies weak TLS cipher suites (RC4, DES, MD5). These should be disabled."
    }
  ]
}

